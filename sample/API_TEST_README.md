# KSF RESTful API æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨æµ‹è¯•è„šæœ¬æ¥éªŒè¯KSF RESTful APIé¡¹ç›®çš„åŠŸèƒ½ã€‚

## æµ‹è¯•è„šæœ¬è¯´æ˜

### 1. `test_api_integration.py` - APIé›†æˆæµ‹è¯•è„šæœ¬

è¿™æ˜¯ä¸€ä¸ªå…¨é¢çš„APIé›†æˆæµ‹è¯•è„šæœ¬ï¼Œæ¨¡æ‹ŸçœŸå®çš„APIè®¿é—®è¯·æ±‚ï¼Œæµ‹è¯•æ‰€æœ‰å­—å…¸ç®¡ç†æ¥å£çš„åŠŸèƒ½ã€‚

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… æµ‹è¯•æ‰€æœ‰CRUDæ“ä½œï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- âœ… æµ‹è¯•åˆ†é¡µåŠŸèƒ½
- âœ… æµ‹è¯•é”™è¯¯å¤„ç†
- âœ… æµ‹è¯•Swaggeræ–‡æ¡£è®¿é—®
- âœ… è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®
- âœ… è¯¦ç»†çš„æµ‹è¯•æ—¥å¿—è¾“å‡º
- âœ… æµ‹è¯•ç»“æœç»Ÿè®¡

**æµ‹è¯•è¦†ç›–çš„APIæ¥å£ï¼š**
- å•ä½ç±»åˆ«ç®¡ç† (`/api/v1/dict/dw-types`)
- å•ä½ç®¡ç† (`/api/v1/dict/dws`)
- äººææœºäºŒçº§åˆ†ç±»å±æ€§ç®¡ç† (`/api/v1/dict/rcj-ejfl-sxs`)
- äººææœºä¸€çº§åˆ†ç±»ç®¡ç† (`/api/v1/dict/rcj-yjfls`)
- äººææœºäºŒçº§åˆ†ç±»ç®¡ç† (`/api/v1/dict/rcj-ejfls`)
- äººææœºåç§°æ˜ å°„ç®¡ç† (`/api/v1/dict/rcj-mc2ejflids`)
- äººææœºåç§°åˆ†ç±»ç®¡ç† (`/api/v1/dict/rcj-mc-classifies`)

### 2. `start_and_test.py` - ä¸€é”®å¯åŠ¨å’Œæµ‹è¯•è„šæœ¬

è¿™æ˜¯ä¸€ä¸ªä¾¿æ·çš„è„šæœ¬ï¼Œå¯ä»¥è‡ªåŠ¨å¯åŠ¨FlaskæœåŠ¡å™¨å¹¶è¿è¡ŒAPIæµ‹è¯•ã€‚

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- ğŸš€ è‡ªåŠ¨å¯åŠ¨FlaskæœåŠ¡å™¨
- ğŸ§ª è‡ªåŠ¨è¿è¡ŒAPIé›†æˆæµ‹è¯•
- ğŸ“Š æ˜¾ç¤ºæµ‹è¯•ç»“æœ
- ğŸ›‘ ä¼˜é›…åœæ­¢æœåŠ¡å™¨
- ğŸ”„ ä¿æŒæœåŠ¡å™¨è¿è¡Œï¼ˆå¯é€‰ï¼‰

## ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šä¸€é”®å¯åŠ¨å’Œæµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œä¸€é”®å¯åŠ¨å’Œæµ‹è¯•è„šæœ¬
python start_and_test.py
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. è‡ªåŠ¨å¯åŠ¨FlaskæœåŠ¡å™¨
2. ç­‰å¾…æœåŠ¡å™¨å®Œå…¨å¯åŠ¨
3. è¿è¡Œæ‰€æœ‰APIæµ‹è¯•
4. æ˜¾ç¤ºæµ‹è¯•ç»“æœ
5. ä¿æŒæœåŠ¡å™¨è¿è¡Œï¼ˆæŒ‰Ctrl+Cåœæ­¢ï¼‰

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æµ‹è¯•

```bash
# 1. é¦–å…ˆå¯åŠ¨FlaskæœåŠ¡å™¨
python run.py

# 2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œæµ‹è¯•
python test_api_integration.py

# æˆ–è€…æŒ‡å®šè‡ªå®šä¹‰æœåŠ¡å™¨åœ°å€
python test_api_integration.py --url http://localhost:5678
```

### æ–¹æ³•ä¸‰ï¼šä»…è¿è¡Œæµ‹è¯•ï¼ˆæœåŠ¡å™¨å·²è¿è¡Œï¼‰

```bash
# åŸºæœ¬ç”¨æ³•
python test_api_integration.py

# æŒ‡å®šæœåŠ¡å™¨åœ°å€
python test_api_integration.py --url http://127.0.0.1:5678

# æŒ‡å®šè¶…æ—¶æ—¶é—´
python test_api_integration.py --timeout 60
```

## æµ‹è¯•å‚æ•°è¯´æ˜

### `test_api_integration.py` å‚æ•°

- `--url`: APIæœåŠ¡å™¨åœ°å€ï¼ˆé»˜è®¤: http://127.0.0.1:5678ï¼‰
- `--timeout`: è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼ˆé»˜è®¤: 30ï¼‰

### ç¤ºä¾‹

```bash
# æµ‹è¯•è¿œç¨‹æœåŠ¡å™¨
python test_api_integration.py --url http://192.168.1.100:5678

# è®¾ç½®æ›´é•¿çš„è¶…æ—¶æ—¶é—´
python test_api_integration.py --timeout 60
```

## æµ‹è¯•è¾“å‡ºè¯´æ˜

### æµ‹è¯•è¿‡ç¨‹è¾“å‡º

æµ‹è¯•è„šæœ¬ä¼šè¾“å‡ºè¯¦ç»†çš„æµ‹è¯•è¿‡ç¨‹ä¿¡æ¯ï¼š

```
[2024-01-01 12:00:00] [INFO] ğŸš€ å¼€å§‹KSF RESTful APIé›†æˆæµ‹è¯•
[2024-01-01 12:00:00] [INFO] æµ‹è¯•ç›®æ ‡: http://127.0.0.1:5678
[2024-01-01 12:00:01] [INFO] ============================================================
[2024-01-01 12:00:01] [INFO] å¼€å§‹æµ‹è¯•å¥åº·æ£€æŸ¥
[2024-01-01 12:00:01] [INFO] å‘é€ GET è¯·æ±‚åˆ° http://127.0.0.1:5678/api/v1/
[2024-01-01 12:00:01] [INFO] å“åº”çŠ¶æ€ç : 404
[2024-01-01 12:00:01] [INFO] âœ… è¯·æ±‚æˆåŠŸ
[2024-01-01 12:00:01] [INFO] âœ… æ ¹è·¯å¾„æµ‹è¯•é€šè¿‡
```

### æµ‹è¯•ç»“æœæ±‡æ€»

æµ‹è¯•å®Œæˆåä¼šæ˜¾ç¤ºç»“æœæ±‡æ€»ï¼š

```
============================================================
ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»
æ€»æµ‹è¯•æ•°: 11
é€šè¿‡: 11
å¤±è´¥: 0
æµ‹è¯•è€—æ—¶: 15.23ç§’
æˆåŠŸç‡: 100.0%
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é¡¹ç›®è¿è¡Œæ­£å¸¸
============================================================
```

## æµ‹è¯•æ•°æ®ç®¡ç†

### è‡ªåŠ¨æ¸…ç†

æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨æ¸…ç†æµ‹è¯•è¿‡ç¨‹ä¸­åˆ›å»ºçš„æ•°æ®ï¼Œç¡®ä¿ä¸ä¼šåœ¨æ•°æ®åº“ä¸­ç•™ä¸‹æµ‹è¯•æ•°æ®ã€‚

### æµ‹è¯•æ•°æ®éš”ç¦»

æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ä½¿ç”¨å”¯ä¸€çš„æµ‹è¯•IDï¼Œé¿å…æ•°æ®å†²çªï¼š

- å•ä½ç±»åˆ«: `TEST_TYPE_001`
- å•ä½: `TEST_DW_001`
- å±æ€§: `TEST_SX_001`
- ä¸€çº§åˆ†ç±»: `TEST_YJFL_001`
- äºŒçº§åˆ†ç±»: `TEST_EJFL_001`

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å™¨å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ç«¯å£5678æ˜¯å¦è¢«å ç”¨
   - æ£€æŸ¥Pythonç¯å¢ƒå’Œä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. **æµ‹è¯•è¿æ¥å¤±è´¥**
   - ç¡®è®¤æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥æœåŠ¡å™¨åœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

3. **æ•°æ®åº“é”™è¯¯**
   - ç¡®è®¤æ•°æ®åº“é…ç½®æ­£ç¡®
   - æ£€æŸ¥æ•°æ®åº“è¿æ¥
   - è¿è¡Œæ•°æ®åº“è¿ç§»

### è°ƒè¯•æ¨¡å¼

å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¯ä»¥ä¿®æ”¹æµ‹è¯•è„šæœ¬ä¸­çš„æ—¥å¿—çº§åˆ«ï¼š

```python
# åœ¨ test_api_integration.py ä¸­
self.log(f"è¯¦ç»†è°ƒè¯•ä¿¡æ¯", "DEBUG")
```

## æ‰©å±•æµ‹è¯•

### æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹

å¯ä»¥åœ¨ `APITester` ç±»ä¸­æ·»åŠ æ–°çš„æµ‹è¯•æ–¹æ³•ï¼š

```python
def test_custom_api(self) -> bool:
    """æµ‹è¯•è‡ªå®šä¹‰API"""
    self.log("å¼€å§‹æµ‹è¯•è‡ªå®šä¹‰API")
    
    # æ·»åŠ æµ‹è¯•é€»è¾‘
    response = self.make_request("GET", "/custom/endpoint")
    
    if "error" not in response:
        self.log("âœ… è‡ªå®šä¹‰APIæµ‹è¯•é€šè¿‡")
        return True
    else:
        self.log("âŒ è‡ªå®šä¹‰APIæµ‹è¯•å¤±è´¥")
        return False
```

ç„¶ååœ¨ `run_all_tests` æ–¹æ³•ä¸­æ·»åŠ æ–°çš„æµ‹è¯•ï¼š

```python
tests = [
    # ... ç°æœ‰æµ‹è¯•
    ("è‡ªå®šä¹‰API", self.test_custom_api),
]
```

## æ€§èƒ½æµ‹è¯•

### å‹åŠ›æµ‹è¯•ç¤ºä¾‹

```python
import concurrent.futures
import time

def stress_test():
    """ç®€å•çš„å‹åŠ›æµ‹è¯•"""
    start_time = time.time()
    
    with concurrent.futures.ThreadPoolExecutor(max_workers=10) as executor:
        futures = []
        for i in range(100):
            future = executor.submit(make_api_request)
            futures.append(future)
        
        # ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆ
        concurrent.futures.wait(futures)
    
    end_time = time.time()
    print(f"å‹åŠ›æµ‹è¯•å®Œæˆï¼Œè€—æ—¶: {end_time - start_time:.2f}ç§’")
```

## æ€»ç»“

è¿™äº›æµ‹è¯•è„šæœ¬æä¾›äº†å…¨é¢çš„APIåŠŸèƒ½éªŒè¯ï¼Œç¡®ä¿é¡¹ç›®èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚å»ºè®®åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è¿è¡Œæµ‹è¯•ï¼š

- ğŸš€ é¡¹ç›®åˆå§‹éƒ¨ç½²å
- ğŸ”„ ä»£ç æ›´æ–°å
- ğŸ› ä¿®å¤bugå
- ğŸ“¦ å‘å¸ƒæ–°ç‰ˆæœ¬å‰

é€šè¿‡å®šæœŸè¿è¡Œè¿™äº›æµ‹è¯•ï¼Œå¯ä»¥ç¡®ä¿APIçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚ 